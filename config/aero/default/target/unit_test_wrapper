#!/bin/bash
HOST_PATH=$1
FULL_COMMAND=${*:2}
TARGET_DIR="/home/jenkins/airliner/build/aero/default"
TARGET_GCOV_PREFIX="${TARGET_DIR}"
TARGET_USER="root"
TARGET_ADDRESS="10.10.0.137"
HOST_DIR_DEPTH=$(find $1 -type d -printf '%d\n' | sort -n | tail -1)

ssh ${TARGET_USER}@${TARGET_ADDRESS} "cd ${TARGET_DIR}; GCOV_PREFIX=${TARGET_GCOV_PREFIX} GCOV_PREFIX_STRIP=${HOST_DIR_DEPTH} ${FULL_COMMAND}"
RETURN_CODE=$?

exit ${RETURN_CODE}
