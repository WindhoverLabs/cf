#!/bin/sh
HOST_PATH=$1
FULL_COMMAND=${*:2}
TARGET_DIR="/home/root/unit-test"
TARGET_GCOV_PREFIX="${TARGET_DIR}/output"
TARGET_USER="root"
TARGET_ADDRESS="zedboard.windhoverlabs.lan"

ssh ${TARGET_USER}@${TARGET_ADDRESS} "mkdir -p ${TARGET_DIR}" || /bin/true
ssh ${TARGET_USER}@${TARGET_ADDRESS} "mkdir -p ${TARGET_GCOV_PREFIX}" || /bin/true
scp ${HOST_PATH}/* ${TARGET_USER}@${TARGET_ADDRESS}:${TARGET_DIR} || /bin/true
ssh ${TARGET_USER}@${TARGET_ADDRESS} "cd ${TARGET_DIR}; GCOV_PREFIX=${TARGET_GCOV_PREFIX} GCOV_PREFIX_STRIP=10 ${FULL_COMMAND}"
RETURN_CODE=$?
scp -r ${TARGET_USER}@${TARGET_ADDRESS}:${TARGET_DIR}/output/* ${HOST_PATH}  || /bin/true
#ssh ${TARGET_USER}@${TARGET_ADDRESS} "rm -Rf ${TARGET_DIR}" || /bin/true

exit ${RETURN_CODE}

